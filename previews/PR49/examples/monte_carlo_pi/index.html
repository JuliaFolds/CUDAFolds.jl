<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Monte-Carlo π · FoldsCUDA</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">FoldsCUDA</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">FoldsCUDA.jl</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../findminmax/"><code>findminmax</code></a></li><li><a class="tocitem" href="../histogram_msd/">Histogram of MSD</a></li><li class="is-active"><a class="tocitem" href>Monte-Carlo π</a><ul class="internal"><li><a class="tocitem" href="#Idea"><span>Idea</span></a></li><li><a class="tocitem" href="#RNG-on-GPU"><span>RNG on GPU</span></a></li><li><a class="tocitem" href="#Using-counter-based-RNG"><span>Using counter-based RNG</span></a></li></ul></li><li><a class="tocitem" href="../inplace_mutation_with_referenceables/">In-place mutation with Referenceables.jl</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Monte-Carlo π</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Monte-Carlo π</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaFolds/FoldsCUDA.jl/blob/master/examples/monte_carlo_pi.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Estimating-π-using-Monte-Carlo-method"><a class="docs-heading-anchor" href="#Estimating-π-using-Monte-Carlo-method">Estimating π using Monte-Carlo method</a><a id="Estimating-π-using-Monte-Carlo-method-1"></a><a class="docs-heading-anchor-permalink" href="#Estimating-π-using-Monte-Carlo-method" title="Permalink"></a></h1><h2 id="Idea"><a class="docs-heading-anchor" href="#Idea">Idea</a><a id="Idea-1"></a><a class="docs-heading-anchor-permalink" href="#Idea" title="Permalink"></a></h2><p>Let&#39;s compute an approximation of π using the <a href="https://en.wikipedia.org/wiki/Monte_Carlo_method">Monte Carlo method</a>.  The idea is to draw points from the uniform distribution on a unit square and count the ratio of points that are inside the quadrant of the unit circle.  Since the probably <span>$p$</span> for a point to be inside the quadrant is the area of the quadrant (<span>$= π / 4$</span>) divided by the area of the unit square (<span>$= 1$</span>), we can estimate <span>$π$</span> by estimating the probability <span>$p = π / 4$</span>:</p><pre><code class="language-julia">xs = rand(10_000)
ys = rand(10_000)
p = count(xs.^2 .+ ys.^2 .&lt; 1) / length(xs)
4 * p</code></pre><pre class="documenter-example-output">3.1604</pre><blockquote><p><img src="https://upload.wikimedia.org/wikipedia/commons/8/84/Pi_30K.gif" alt="Illustration of monte-Carlo method for computing pi"/></p><p>–- <a href="https://en.wikipedia.org/wiki/File:Pi_30K.gif">File:Pi 30K.gif - Wikipedia</a> by <a href="https://commons.wikimedia.org/wiki/User:Nicoguaro">nicoguaro</a> is licensed under <a href="https://creativecommons.org/licenses/by/3.0/deed.en">CC BY 3.0</a>.</p></blockquote><h2 id="RNG-on-GPU"><a class="docs-heading-anchor" href="#RNG-on-GPU">RNG on GPU</a><a id="RNG-on-GPU-1"></a><a class="docs-heading-anchor-permalink" href="#RNG-on-GPU" title="Permalink"></a></h2><p>We try to do this computation on a GPU using FoldsCUDA.jl:</p><pre><code class="language-julia">using CUDA
using FLoops
using FoldsCUDA</code></pre><p>As of writing, <code>CUDA.CURAND</code> does not provide the API usable inside the loop body (i.e., the device API).  However, we can use pure-Julia pseudo number generator quite easily.  In particular, we use a <a href="https://en.wikipedia.org/wiki/Counter-based_random_number_generator_(CBRNG)">Counter-based random number generator (CBRNG)</a> provided by <a href="https://github.com/sunoru/Random123.jl">Random123.jl</a> (<a href="https://sunoru.github.io/RandomNumbers.jl/stable/man/random123/">documentation</a>).</p><pre><code class="language-julia">using Random123</code></pre><p>In this example, we use <a href="https://sunoru.github.io/RandomNumbers.jl/stable/lib/random123/#Random123.Philox2x"><code>Random123.Philox2x</code></a>. This RNG gives us two <code>UInt64</code>s for each counter which wraps around at <code>typemax(UInt64)</code>:</p><pre><code class="language-julia">rng_a = Philox2x(0)
rng_b = Philox2x(0)
set_counter!(rng_b, typemax(UInt64))
rand(rng_b, UInt64, 2)
@assert rng_a == rng_b</code></pre><h2 id="Using-counter-based-RNG"><a class="docs-heading-anchor" href="#Using-counter-based-RNG">Using counter-based RNG</a><a id="Using-counter-based-RNG-1"></a><a class="docs-heading-anchor-permalink" href="#Using-counter-based-RNG" title="Permalink"></a></h2><p>Let&#39;s create a helper function that divides <code>UInt64(0):typemax(UInt64)</code> into <code>n</code> equal intervals:</p><pre><code class="language-julia">function counters(n)
    stride = typemax(UInt64) ÷ n
    return UInt64(0):stride:typemax(UInt64)-stride
end</code></pre><p>This lets us use &quot;independent&quot; RNG for each <code>ctr</code>-th iteration:</p><pre><code class="language-julia">function monte_carlo_pi(n, m = 10_000, ex = has_cuda_gpu() ? CUDAEx() : ThreadedEx())
    @floop ex for ctr in counters(n)
        rng = set_counter!(Philox2x(0), ctr)
        nhits = 0
        for _ in 1:m
            x = rand(rng)
            y = rand(rng)
            nhits += x^2 + y^2 &lt; 1
        end
        @reduce(tot = 0 + nhits)
    end
    return 4 * tot / (n * m)
end</code></pre><pre><code class="language-julia">πₐₚₚᵣₒₓ = monte_carlo_pi(2^12)</code></pre><pre class="documenter-example-output">3.1411634765625</pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../histogram_msd/">« Histogram of MSD</a><a class="docs-footer-nextpage" href="../inplace_mutation_with_referenceables/">In-place mutation with Referenceables.jl »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 8 March 2021 02:28">Monday 8 March 2021</span>. Using Julia version 1.5.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
